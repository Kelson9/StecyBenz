<div class="analytics-page">
  <div class="container">
    
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">Analytics Dashboard</h1>
        <p class="page-subtitle">Track your business performance and insights</p>
      </div>
      
      <div class="header-actions">
        <div class="date-range-selector">
          <select [(ngModel)]="selectedDateRange" (change)="onDateRangeChange()" class="date-select">
            <option *ngFor="let range of dateRanges" [value]="range.value">
              {{ range.label }}
            </option>
          </select>
          
          <div *ngIf="selectedDateRange === 'custom'" class="custom-date-inputs">
            <input 
              type="date" 
              [(ngModel)]="customStartDate"
              (change)="onCustomDateChange()"
              class="date-input">
            <span>to</span>
            <input 
              type="date" 
              [(ngModel)]="customEndDate"
              (change)="onCustomDateChange()"
              class="date-input">
          </div>
        </div>
        
        <button class="btn btn-outline" (click)="onRefreshData()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"/>
            <path d="M15 12a3 3 0 11-6 0"/>
          </svg>
          Refresh
        </button>
        
        <button class="btn btn-primary" (click)="onExportReport()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/>
            <polyline points="7,10 12,15 17,10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Export Report
        </button>
      </div>
    </div>

    <!-- Key Metrics Overview -->
    <div class="metrics-grid">
      <!-- Revenue Metric -->
      <div class="metric-card revenue">
        <div class="metric-header">
          <div class="metric-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="1" x2="12" y2="23"/>
              <path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
            </svg>
          </div>
          <div class="metric-title">Total Revenue</div>
        </div>
        <div class="metric-value">{{ formatCurrency(analyticsData.revenue.total) }}</div>
        <div class="metric-change" [class]="getGrowthClass(analyticsData.revenue.growth)">
          {{ getGrowthIcon(analyticsData.revenue.growth) }} {{ formatPercentage(analyticsData.revenue.growth) }} vs last period
        </div>
        <div class="metric-progress">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getProgressPercentage(analyticsData.revenue.total, analyticsData.revenue.target)"></div>
          </div>
          <div class="progress-text">
            {{ formatCurrency(analyticsData.revenue.total) }} of {{ formatCurrency(analyticsData.revenue.target) }} target
          </div>
        </div>
      </div>

      <!-- Orders Metric -->
      <div class="metric-card orders">
        <div class="metric-header">
          <div class="metric-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
            </svg>
          </div>
          <div class="metric-title">Total Orders</div>
        </div>
        <div class="metric-value">{{ formatNumber(analyticsData.orders.total) }}</div>
        <div class="metric-change" [class]="getGrowthClass(analyticsData.orders.growth)">
          {{ getGrowthIcon(analyticsData.orders.growth) }} {{ formatPercentage(analyticsData.orders.growth) }} vs last period
        </div>
        <div class="metric-breakdown">
          <div class="breakdown-item">
            <span class="breakdown-label">Completed:</span>
            <span class="breakdown-value success">{{ formatNumber(analyticsData.orders.completed) }}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Pending:</span>
            <span class="breakdown-value warning">{{ formatNumber(analyticsData.orders.pending) }}</span>
          </div>
          <div class="breakdown-item">
            <span class="breakdown-label">Cancelled:</span>
            <span class="breakdown-value danger">{{ formatNumber(analyticsData.orders.cancelled) }}</span>
          </div>
        </div>
      </div>

      <!-- Average Order Value -->
      <div class="metric-card aov">
        <div class="metric-header">
          <div class="metric-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 2L2 7l10 5 10-5-10-5z"/>
              <path d="M2 17l10 5 10-5"/>
              <path d="M2 12l10 5 10-5"/>
            </svg>
          </div>
          <div class="metric-title">Avg Order Value</div>
        </div>
        <div class="metric-value">{{ formatCurrency(getAverageOrderValue()) }}</div>
        <div class="metric-change positive">
          ↗ 5.2% vs last period
        </div>
        <div class="metric-mini-chart">
          <!-- Simple trend visualization -->
          <div class="trend-line">
            <div class="trend-point" *ngFor="let point of [85, 92, 88, 95, 102, 110, 125]; let i = index" 
                 [style.height.%]="(point / 125) * 100"></div>
          </div>
        </div>
      </div>

      <!-- Conversion Rate -->
      <div class="metric-card conversion">
        <div class="metric-header">
          <div class="metric-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
          </div>
          <div class="metric-title">Conversion Rate</div>
        </div>
        <div class="metric-value">{{ formatPercentage(analyticsData.conversion.rate) }}</div>
        <div class="metric-change positive">
          ↗ 0.8% vs last period
        </div>
        <div class="conversion-funnel">
          <div *ngFor="let stage of getConversionFunnelData()" class="funnel-stage">
            <div class="funnel-bar" [style.width.%]="stage.percentage"></div>
            <div class="funnel-label">{{ stage.stage }}: {{ formatCompactNumber(stage.count) }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      
      <!-- Revenue Chart -->
      <div class="chart-card large">
        <div class="chart-header">
          <h3>Revenue Trend</h3>
          <div class="chart-controls">
            <button class="btn btn-sm btn-outline">Daily</button>
            <button class="btn btn-sm btn-primary">Monthly</button>
            <button class="btn btn-sm btn-outline">Yearly</button>
          </div>
        </div>
        <div class="chart-container">
          <div class="simple-line-chart">
            <div class="chart-grid">
              <div *ngFor="let point of analyticsData.revenue.monthly; let i = index" 
                   class="chart-bar"
                   [style.height.%]="(point.value / 80000) * 100"
                   [title]="formatCurrency(point.value)">
                <div class="bar-label">{{ point.date.split('-')[1] }}</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Payment Methods -->
      <div class="chart-card">
        <div class="chart-header">
          <h3>Payment Methods</h3>
        </div>
        <div class="payment-methods-chart">
          <div *ngFor="let method of analyticsData.payments.methods" class="payment-method-item">
            <div class="payment-method-info">
              <div class="payment-icon">{{ getPaymentMethodIcon(method.method) }}</div>
              <div class="payment-details">
                <div class="payment-name">{{ method.method }}</div>
                <div class="payment-amount">{{ formatCurrency(method.amount) }}</div>
              </div>
            </div>
            <div class="payment-percentage">{{ formatPercentage(method.percentage) }}</div>
            <div class="payment-bar">
              <div class="payment-fill" [style.width.%]="method.percentage"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secondary Metrics -->
    <div class="secondary-metrics">
      
      <!-- Customer Segments -->
      <div class="metric-section">
        <div class="section-header">
          <h3>Customer Segments</h3>
          <button class="btn btn-sm btn-outline">View Details</button>
        </div>
        <div class="customer-segments">
          <div *ngFor="let segment of analyticsData.customers.segments" class="segment-item">
            <div class="segment-info">
              <div class="segment-name">{{ segment.segment }}</div>
              <div class="segment-stats">
                <span class="stat-item">{{ formatNumber(segment.customers) }} customers</span>
                <span class="stat-item">{{ formatCurrency(segment.revenue) }} revenue</span>
                <span class="stat-item">{{ formatCurrency(segment.averageOrder) }} AOV</span>
              </div>
            </div>
            <div class="segment-percentage">{{ formatPercentage(segment.percentage) }}</div>
          </div>
        </div>
      </div>

      <!-- Top Products -->
      <div class="metric-section">
        <div class="section-header">
          <h3>Top Performing Products</h3>
          <button class="btn btn-sm btn-outline">View All</button>
        </div>
        <div class="top-products">
          <div *ngFor="let product of getTopPerformingProducts(); let i = index" class="product-item">
            <div class="product-rank">{{ i + 1 }}</div>
            <div class="product-info">
              <div class="product-name">{{ product.name }}</div>
              <div class="product-category">{{ product.category }}</div>
            </div>
            <div class="product-stats">
              <div class="product-revenue">{{ formatCurrency(product.revenue) }}</div>
              <div class="product-growth" [class]="getGrowthClass(product.growth)">
                {{ getGrowthIcon(product.growth) }} {{ formatPercentage(Math.abs(product.growth)) }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Stats Grid -->
    <div class="stats-grid">
      
      <!-- Payment Success Rate -->
      <div class="stat-card">
        <div class="stat-icon success">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
            <polyline points="22,4 12,14.01 9,11.01"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatPercentage(analyticsData.payments.successRate) }}</div>
          <div class="stat-label">Payment Success Rate</div>
          <div class="stat-change positive">+0.5% this month</div>
        </div>
      </div>

      <!-- New Customers -->
      <div class="stat-card">
        <div class="stat-icon info">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/>
            <circle cx="8.5" cy="7" r="4"/>
            <line x1="20" y1="8" x2="20" y2="14"/>
            <line x1="23" y1="11" x2="17" y2="11"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatNumber(analyticsData.customers.newCustomers) }}</div>
          <div class="stat-label">New Customers</div>
          <div class="stat-change positive">+23% this month</div>
        </div>
      </div>

      <!-- Return Rate -->
      <div class="stat-card">
        <div class="stat-icon warning">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
            <path d="M9 12l2 2 4-4"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatPercentage(analyticsData.customers.returningRate) }}</div>
          <div class="stat-label">Customer Return Rate</div>
          <div class="stat-change positive">+5.2% this month</div>
        </div>
      </div>

      <!-- Bounce Rate -->
      <div class="stat-card">
        <div class="stat-icon danger">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 15l4-4-4-4"/>
            <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatPercentage(analyticsData.conversion.bounceRate) }}</div>
          <div class="stat-label">Bounce Rate</div>
          <div class="stat-change negative">-2.1% this month</div>
        </div>
      </div>
    </div>

    <!-- Category Performance -->
    <div class="category-performance">
      <div class="section-header">
        <h3>Category Performance</h3>
      </div>
      <div class="category-chart">
        <div *ngFor="let category of analyticsData.products.categories" class="category-item">
          <div class="category-info">
            <div class="category-color" [style.background-color]="category.color"></div>
            <div class="category-name">{{ category.label }}</div>
          </div>
          <div class="category-percentage">{{ formatPercentage(category.value) }}</div>
          <div class="category-bar">
            <div class="category-fill" 
                 [style.width.%]="category.value" 
                 [style.background-color]="category.color"></div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>