<div class="orders-page">
  <div class="container">
    
    <!-- Page Header -->
    <div class="page-header">
      <div class="header-content">
        <h1 class="page-title">Orders Management</h1>
        <p class="page-subtitle">Track and manage all customer orders</p>
      </div>
      
      <div class="header-actions">
        <button class="btn btn-outline" (click)="onExportOrders()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7,10 12,15 17,10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Export Data
        </button>
        <button class="btn btn-outline" (click)="clearFilters()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"/>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
            <line x1="10" y1="11" x2="10" y2="17"/>
            <line x1="14" y1="11" x2="14" y2="17"/>
          </svg>
          Clear Filters
        </button>
      </div>
    </div>

    <!-- Stats Overview -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon orders">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
            <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.totalOrders }}</div>
          <div class="stat-label">Total Orders</div>
          <div class="stat-change positive">+12% from last month</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon pending">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"/>
            <polyline points="12,6 12,12 16,14"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ stats.pendingOrders }}</div>
          <div class="stat-label">Pending Orders</div>
          <div class="stat-change neutral">{{ (stats.pendingOrders / stats.totalOrders * 100) | number:'1.1-1' }}% of total</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon revenue">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="1" x2="12" y2="23"/>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(stats.totalRevenue) }}</div>
          <div class="stat-label">Total Revenue</div>
          <div class="stat-change positive">+18% from last month</div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon average">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
            <path d="M9 12l2 2 4-4"/>
          </svg>
        </div>
        <div class="stat-content">
          <div class="stat-value">{{ formatCurrency(stats.averageOrderValue) }}</div>
          <div class="stat-label">Average Order Value</div>
          <div class="stat-change positive">+5% from last month</div>
        </div>
      </div>
    </div>

    <!-- Orders List View -->
    <div class="orders-content" *ngIf="currentView === 'list'">
      
      <!-- Filters Section -->
      <div class="filters-section">
        <div class="filters-row">
          <div class="search-box">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input 
              type="text" 
              [(ngModel)]="searchTerm"
              placeholder="Search orders, customers, or products..."
              class="search-input">
          </div>
          
          <select [(ngModel)]="selectedStatus" class="filter-select">
            <option value="">All Status</option>
            <option value="pending">Pending</option>
            <option value="confirmed">Confirmed</option>
            <option value="processing">Processing</option>
            <option value="shipped">Shipped</option>
            <option value="delivered">Delivered</option>
            <option value="cancelled">Cancelled</option>
            <option value="refunded">Refunded</option>
          </select>

          <select [(ngModel)]="selectedPaymentStatus" class="filter-select">
            <option value="">Payment Status</option>
            <option value="pending">Pending</option>
            <option value="paid">Paid</option>
            <option value="failed">Failed</option>
            <option value="refunded">Refunded</option>
          </select>

          <select [(ngModel)]="selectedDateRange" class="filter-select">
            <option value="7">Last 7 days</option>
            <option value="30">Last 30 days</option>
            <option value="90">Last 3 months</option>
            <option value="365">Last year</option>
            <option value="all">All time</option>
          </select>

          <select [(ngModel)]="sortBy" class="filter-select">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="amount-high">Highest Amount</option>
            <option value="amount-low">Lowest Amount</option>
            <option value="customer">Customer Name</option>
          </select>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="table-container">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order</th>
              <th>Customer</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Payment</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of paginatedOrders; trackBy: trackByOrderId" class="order-row">
              <td>
                <div class="order-info" (click)="selectOrder(order)">
                  <div class="order-number">{{ order.orderNumber }}</div>
                  <div class="order-meta">
                    <span class="item-count">{{ order.items.length }} item{{ order.items.length > 1 ? 's' : '' }}</span>
                    <span *ngIf="order.trackingNumber" class="tracking">â€¢ {{ order.trackingNumber }}</span>
                  </div>
                </div>
              </td>
              
              <td>
                <div class="customer-info" (click)="onViewCustomer(order.customer.id)">
                  <div class="customer-avatar">
                    <img *ngIf="order.customer.avatar" [src]="order.customer.avatar" [alt]="order.customer.name">
                    <div *ngIf="!order.customer.avatar" class="avatar-placeholder">
                      {{ getInitials(order.customer.name) }}
                    </div>
                  </div>
                  <div class="customer-details">
                    <div class="customer-name">{{ order.customer.name }}</div>
                    <div class="customer-email">{{ order.customer.email }}</div>
                  </div>
                </div>
              </td>
              
              <td>
                <div class="order-items">
                  <div class="item-preview" *ngFor="let item of order.items.slice(0, 3)">
                    <img [src]="item.productImage" [alt]="item.productName" class="item-image">
                  </div>
                  <span *ngIf="order.items.length > 3" class="more-items">
                    +{{ order.items.length - 3 }} more
                  </span>
                </div>
              </td>
              
              <td>
                <div class="order-total">
                  <div class="total-amount">{{ formatCurrency(order.total) }}</div>
                  <div class="payment-method">{{ order.paymentMethod }}</div>
                </div>
              </td>
              
              <td>
                <select 
                  class="status-select" 
                  [class]="getStatusBadgeClass(order.status)"
                  [value]="order.status"
                  (change)="onUpdateStatus(order, $event)">
                  <option value="pending">PENDING</option>
                  <option value="confirmed">CONFIRMED</option>
                  <option value="processing">PROCESSING</option>
                  <option value="shipped">SHIPPED</option>
                  <option value="delivered">DELIVERED</option>
                  <option value="cancelled">CANCELLED</option>
                  <option value="refunded">REFUNDED</option>
                </select>
              </td>
              
              <td>
                <span class="badge" [class]="getPaymentStatusClass(order.paymentStatus)">
                  {{ order.paymentStatus }}
                </span>
              </td>
              
              <td>
                <div class="date-info">
                  <div class="order-date">{{ formatShortDate(order.orderDate) }}</div>
                  <div *ngIf="order.estimatedDelivery" class="delivery-date">
                    Delivery: {{ formatShortDate(order.estimatedDelivery) }}
                  </div>
                </div>
              </td>
              
              <td>
                <div class="action-buttons">
                  <button class="btn-icon" (click)="selectOrder(order)" title="View Details">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                  </button>
                  
                  <button class="btn-icon" (click)="onPrintOrder(order)" title="Print Order">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <polyline points="6,9 6,2 18,2 18,9"/>
                      <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
                      <rect x="6" y="14" width="12" height="8"/>
                    </svg>
                  </button>
                  
                  <div class="dropdown">
                    <button class="btn-icon dropdown-toggle" title="More Actions">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="1"/>
                        <circle cx="12" cy="5" r="1"/>
                        <circle cx="12" cy="19" r="1"/>
                      </svg>
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="pagination" *ngIf="totalPages > 1">
        <button class="btn btn-outline btn-sm" (click)="prevPage()" [disabled]="currentPage === 1">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
          Previous
        </button>
        
        <div class="pagination-numbers">
          <button 
            *ngFor="let page of [].constructor(Math.min(totalPages, 5)); let i = index" 
            class="page-btn"
            [class.active]="currentPage === i + 1"
            (click)="goToPage(i + 1)">
            {{ i + 1 }}
          </button>
        </div>
        
        <button class="btn btn-outline btn-sm" (click)="nextPage()" [disabled]="currentPage === totalPages">
          Next
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>

      <!-- Results Info -->
      <div class="results-info">
        <p>Showing {{ (currentPage - 1) * itemsPerPage + 1 }}-{{ Math.min(currentPage * itemsPerPage, filteredOrders.length) }} of {{ filteredOrders.length }} orders</p>
      </div>
    </div>

    <!-- Order Details View -->
    <div class="orders-content" *ngIf="currentView === 'details' && selectedOrder">
      <div class="order-details">
        
        <!-- Back Button and Header -->
        <div class="order-details-header">
          <div class="order-title">
            <button class="btn btn-outline btn-sm back-btn" (click)="backToList()">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5"/>
                <path d="M12 19l-7-7 7-7"/>
              </svg>
              Back to Orders
            </button>
            <h2>{{ selectedOrder.orderNumber }}</h2>
            <div class="order-badges">
              <span class="badge" [class]="getStatusBadgeClass(selectedOrder.status)">{{ selectedOrder.status }}</span>
              <span class="badge" [class]="getPaymentStatusClass(selectedOrder.paymentStatus)">{{ selectedOrder.paymentStatus }}</span>
            </div>
          </div>
          
          <div class="order-actions">
            <button class="btn btn-outline" (click)="onPrintOrder(selectedOrder)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6,9 6,2 18,2 18,9"/>
                <path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/>
                <rect x="6" y="14" width="12" height="8"/>
              </svg>
              Print Order
            </button>
            <button class="btn btn-outline" (click)="onSendStatusUpdate(selectedOrder)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                <polyline points="22,6 12,13 2,6"/>
              </svg>
              Send Update
            </button>
          </div>
        </div>

        <!-- Order Details Grid -->
        <div class="details-grid">
          
          <!-- Customer Information -->
          <div class="details-card">
            <h3>Customer Information</h3>
            <div class="customer-details-full">
              <div class="customer-avatar-large">
                <img *ngIf="selectedOrder.customer.avatar" [src]="selectedOrder.customer.avatar" [alt]="selectedOrder.customer.name">
                <div *ngIf="!selectedOrder.customer.avatar" class="avatar-placeholder">
                  {{ getInitials(selectedOrder.customer.name) }}
                </div>
              </div>
              <div class="customer-info-full">
                <h4>{{ selectedOrder.customer.name }}</h4>
                <div class="customer-contact">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                    <polyline points="22,6 12,13 2,6"/>
                  </svg>
                  {{ selectedOrder.customer.email }}
                </div>
                <div class="customer-contact">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z"/>
                  </svg>
                  {{ selectedOrder.customer.phone }}
                </div>
              </div>
            </div>
          </div>

          <!-- Shipping Address -->
          <div class="details-card">
            <h3>Shipping Address</h3>
            <div class="address-info">
              <p>{{ selectedOrder.shippingAddress.street }}</p>
              <p>{{ selectedOrder.shippingAddress.city }}, {{ selectedOrder.shippingAddress.state }} {{ selectedOrder.shippingAddress.zipCode }}</p>
              <p>{{ selectedOrder.shippingAddress.country }}</p>
            </div>
            
            <div *ngIf="selectedOrder.trackingNumber" class="tracking-info">
              <strong>Tracking Number:</strong>
              <span class="tracking-number">{{ selectedOrder.trackingNumber }}</span>
            </div>
          </div>

          <!-- Order Timeline -->
          <div class="details-card">
            <h3>Order Timeline</h3>
            <div class="timeline">
              <div class="timeline-item">
                <div class="timeline-marker"></div>
                <div class="timeline-content">
                  <div class="timeline-title">Order Placed</div>
                  <div class="timeline-date">{{ formatDate(selectedOrder.orderDate) }}</div>
                </div>
              </div>
              <div *ngIf="selectedOrder.estimatedDelivery" class="timeline-item">
                <div class="timeline-marker"></div>
                <div class="timeline-content">
                  <div class="timeline-title">Estimated Delivery</div>
                  <div class="timeline-date">{{ formatDate(selectedOrder.estimatedDelivery) }}</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Notes -->
          <div *ngIf="selectedOrder.notes" class="details-card">
            <h3>Order Notes</h3>
            <div class="order-notes">
              {{ selectedOrder.notes }}
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="order-items-section">
          <h3>Order Items ({{ selectedOrder.items.length }})</h3>
          <div class="items-table-container">
            <table class="items-table">
              <thead>
                <tr>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of selectedOrder.items">
                  <td>
                    <div class="product-info" (click)="onViewProduct(item.id)">
                      <img [src]="item.productImage" [alt]="item.productName" class="product-image">
                      <div class="product-details">
                        <h4>{{ item.productName }}</h4>
                        <p class="product-id">ID: {{ item.id }}</p>
                      </div>
                    </div>
                  </td>
                  <td class="quantity">{{ item.quantity }}</td>
                  <td class="price">{{ formatCurrency(item.price) }}</td>
                  <td class="total">{{ formatCurrency(item.total) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Order Summary</h3>
          <div class="summary-details">
            <div class="summary-row">
              <span>Subtotal:</span>
              <span>{{ formatCurrency(selectedOrder.subtotal) }}</span>
            </div>
            <div class="summary-row">
              <span>Tax:</span>
              <span>{{ formatCurrency(selectedOrder.tax) }}</span>
            </div>
            <div class="summary-row">
              <span>Shipping:</span>
              <span>{{ formatCurrency(selectedOrder.shipping) }}</span>
            </div>
            <div *ngIf="selectedOrder.discount > 0" class="summary-row">
              <span>Discount:</span>
              <span class="discount">-{{ formatCurrency(selectedOrder.discount) }}</span>
            </div>
            <div class="summary-row total">
              <span><strong>Total:</strong></span>
              <span><strong>{{ formatCurrency(selectedOrder.total) }}</strong></span>
            </div>
            <div class="summary-row payment-method">
              <span>Payment Method:</span>
              <span>{{ selectedOrder.paymentMethod }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>